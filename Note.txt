frontend/
â”‚â”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ MapView.jsx
â”‚   â”‚   â”œâ”€â”€ IssueModal.jsx
â”‚   â”‚   â”œâ”€â”€ IssuePopup.jsx
â”‚   â”‚   â”œâ”€â”€ MapClickHandler.jsx
â”‚   â”‚   â”œâ”€â”€ StatusBadgeIcon.jsx
â”‚   â”‚   â”œâ”€â”€ Navbar.jsx
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Login.jsx
â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
â”‚   â”‚   â”œâ”€â”€ Admin.jsx
â”‚   â”œâ”€â”€ services/api.js
â”‚   â”œâ”€â”€ App.jsx
â”‚â”€â”€ tailwind.config.js

backend/
â”‚â”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ database.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ issue.py
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”œâ”€â”€ issues.py
â”‚   â”‚   â”œâ”€â”€ IssueImages.py
â”‚   â”‚   â”œâ”€â”€ users.py
â”‚   â”‚   â”œâ”€â”€ admin.py
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ jwt.py
â”‚   â”‚   â”œâ”€â”€ gps.py
â”‚   â”‚   â”œâ”€â”€ image_exif.py
â”‚   â”œâ”€â”€ dependencies
â”‚   â”œ      â”œâ”€â”€ admin.py
â”‚   â”œ      â”œâ”€â”€ auth.py
â”‚   â”œâ”€â”€ schemas
â”‚   |      â”œâ”€â”€ issue.py
â”‚   â”œâ”€â”€ uploads
â”‚   |      â”œâ”€â”€ issues
â”‚   â”œâ”€â”€ utils
â”‚          â”œâ”€â”€ constants.py
â”‚          â”œâ”€â”€ distance.py
â”‚          â”œâ”€â”€ exif.py
â”‚          â”œâ”€â”€ geo.py
â”‚          â”œâ”€â”€ jwt.py
â”‚          â”œâ”€â”€ security.py
â”‚â”€â”€ database.py
â”‚â”€â”€ main.py
â”‚â”€â”€ requirements.txt




















PHASE 2 â€” CORE MAP INTELLIGENCE (STARTING NOW)
ğŸ”¹ 2.1 Live User Location Tracking

Goal: User location updates every few seconds

Use navigator.geolocation.watchPosition

Store in frontend state only (for now)

Marker updates smoothly

ğŸ“ Affects:

MapView.jsx

ğŸ”¹ 2.2 Route Awareness (Travel Detection)

Goal: If user is traveling, issues along route get detected

Concept (important):

User Location A â†’ Location B
â†“
Create a route polyline
â†“
Check issues within X meters of route
â†“
Notify user


ğŸ“ Backend:

utils/distance.py

New helper: is_point_near_route()

ğŸ“ Frontend:

Draw route polyline (later)

Fetch /issues/along-route

âš ï¸ We will NOT do Google Directions API yet â€” open-source first.

ğŸ”” 2.3 Smart Notifications (Nearby Issues)

Goal: Notify when user comes near an issue

Rules:

Only notify once per issue

Distance threshold (e.g. 200m)

Do NOT spam

ğŸ“ Frontend:

MapView.jsx

New: useNearbyIssues.js (later)

ğŸ” PHASE 3 â€” SEARCH & NAVIGATION
ğŸ”¹ 3.1 Location Search Bar

Like Google Maps search.

Options:

OpenStreetMap Nominatim API (FREE)

Search â†’ lat/lng â†’ pan map

ğŸ“ Frontend:

Navbar.jsx (Search input)

MapView.jsx (map.flyTo)

ğŸ”¹ 3.2 Issue Filters

By type

By status

By distance

ğŸ“ Frontend:

Sidebar / Drawer UI

Reuse StatusBadgeIcon.jsx

ğŸ‘¤ PHASE 4 â€” PROFILE & REPUTATION
ğŸ”¹ 4.1 Profile Button

Issues reported

Issues validated

Reputation score

ğŸ“ Backend:

/users/me

reputation logic

ğŸ“ Frontend:

Navbar â†’ Profile dropdown

ğŸ”¹ 4.2 Reputation Logic

Example:

+5 for valid issue

+1 for validation

âˆ’10 for rejected/fake

(This already matches your validate flow idea)

ğŸ§¾ PHASE 5 â€” ISSUE DRAWER (UX POLISH)

Replace popup with side drawer:

Images

Validations

Status

Validate button (disabled for owner)

ğŸ“ Frontend:

Replace IssuePopup.jsx usage

Drawer component

ğŸ”¥ IMPORTANT: HOW WE WILL WORK (NO CHAOS)

âœ… One feature at a time

âœ… I modify only required files

âœ… I explain why, not just what

âŒ No sudden refactors

âŒ No â€œtrust me broâ€ code

â–¶ï¸ NEXT STEP (START NOW)

We start PHASE 2.1:

ğŸ‘‰ Live location tracking (moving user marker)

Reply with just:

START PHASE 2.1


Iâ€™ll then:

Modify only MapView.jsx

Add live tracking cleanly

No UI break

No auth issues




MAPVIEW
// summarising the code
/*
This code implements a map-based interface for reporting and viewing issues. It uses Mapbox for mapping and Deck.gl for rendering layers. Users can view nearby issues, report new ones, and get directions. The interface includes features like geolocation tracking, issue filtering, and route planning.
*/
// the structure and workflow of the code:
/*
1. State Management:
   - position: Current user location [lat, lng]
   - issues: Array of reported issues
   - searchLocation: Location selected from search
   - issueFilter: Filter criteria for issues
   - mapStyleId: Current map style
   - show3D: Toggle for 3D mode
   - routeOpen: Toggle for route planning panel
   - startQuery/destQuery: Input text for route planning
   - startLocation/destLocation: Selected start/destination points
   - routePath: Calculated route path
   - routeSummary: Summary of the route
   - startSuggestions/destSuggestions: Autocomplete suggestions
   - alertedIssuesRef: Set to track alerted issues
   - notifications: Array of notifications
   - isLoadingIssues: Loading state for issues
   - followUser: Toggle for following user location
   - geoError: Geolocation error message
   - hasCenteredRef: Flag to prevent multiple initial centering

2. Geolocation:
   - Uses navigator.geolocation.watchPosition to track user location
   - Updates position state and centers map when followUser is enabled
   - Handles geolocation errors and displays messages
   - Clears watch on component unmount

3. Issue Management:
   - fetchAllIssues: Fetches all issues from the backend
   - Periodic polling (every 30 seconds) to keep issues in sync
   - Nearby issue alerts: Notifies user when within 200m of an issue
   - Uses alertedIssuesRef to prevent duplicate alerts
   - addNotification: Displays toast notifications

4. Route Planning:
   - fetchRoute: Fetches route from Mapbox Directions API
   - fetchSuggestions: Fetches geocoding suggestions from Mapbox
   - Handles route planning panel with start and destination inputs
   - Displays route path and summary (distance, duration)
   - Supports "Current location" as start point

5. Map Rendering:
   - Uses DeckMap component for map display
   - Renders issue markers with different colors based on type
   - Supports 3D mode with extruded polygons
   - Handles map clicks for selecting locations
   - Supports different map styles via mapStyleId

6. User Interaction:
   - Toggle issue visibility
   - Toggle 3D mode
   - Open/close route planning panel
   - Select start/destination locations
   - Get directions
   - Use current location as start point
   - Toggle follow user location

7. API Integration:
   - api.get(`/issues/`): Fetches all issues
   - fetchRoute: Calls Mapbox Directions API
   - fetchSuggestions: Calls Mapbox Geocoding API

8. Notifications:
   - Toast notifications for nearby issues and errors
   - Auto-dismiss after 5 seconds
   - Unique IDs to prevent duplicates

9. Error Handling:
   - Geolocation errors
   - Issue fetching errors
   - Route fetching errors
   - Notification display for all errors

10. Performance:
    - Periodic issue polling (30 seconds)
    - Debounced suggestion fetching (not explicitly shown but implied)
    - Uses refs to prevent unnecessary re-renders
    - Conditional rendering to optimize updates

Workflow:
1. Component mounts and initializes state
2. Geolocation starts tracking user position
3. Issues are fetched from the backend
4. Nearby issues trigger notifications
5. User can interact with the map, filter issues, and plan routes
6. Route planning uses Mapbox API to calculate and display routes
7. Component cleans up geolocation on unmount
*/



